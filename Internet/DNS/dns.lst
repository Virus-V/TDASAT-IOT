   1              		.syntax unified
   2              		.cpu cortex-m3
   3              		.fpu softvfp
   4              		.eabi_attribute 20, 1
   5              		.eabi_attribute 21, 1
   6              		.eabi_attribute 23, 3
   7              		.eabi_attribute 24, 1
   8              		.eabi_attribute 25, 1
   9              		.eabi_attribute 26, 1
  10              		.eabi_attribute 30, 6
  11              		.eabi_attribute 34, 1
  12              		.eabi_attribute 18, 4
  13              		.thumb
  14              		.file	"dns.c"
  15              		.text
  16              	.Ltext0:
  17              		.cfi_sections	.debug_frame
  18              		.comm	dns_buf,4,4
  19              		.comm	DNS_SOCKET,1,1
  20              		.comm	MSG_ID,2,2
  21              		.comm	dns_time,4,4
  22              		.section	.text.put16,"ax",%progbits
  23              		.align	2
  24              		.global	put16
  25              		.thumb
  26              		.thumb_func
  28              	put16:
  29              	.LFB0:
  30              		.file 1 "/home/virusv/TDSAST_IOT/Internet/DNS/dns.c"
   1:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** #include <stdio.h>
   2:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** #include <string.h>
   3:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** #include <stdlib.h>
   4:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
   5:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** #include "dns.h"
   6:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** #include "socket.h"
   7:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** #include "dns_parse.h"
   8:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
   9:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
  10:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** /*
  11:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** ********************************************************************************
  12:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** Define Part
  13:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** ********************************************************************************
  14:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** */
  15:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** //#define _DNS_DEBUG_
  16:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
  17:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** /*
  18:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** ********************************************************************************
  19:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** Local Variable Declaration Section
  20:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** ********************************************************************************
  21:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** */
  22:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** uint8_t * dns_buf;
  23:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** uint8_t DNS_SOCKET;
  24:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** uint16_t MSG_ID;
  25:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
  26:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** uint32_t dns_time;
  27:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
  28:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** /*
  29:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** ********************************************************************************
  30:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** Function Implementation Part
  31:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** ********************************************************************************
  32:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** */
  33:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** uint8_t * put16(uint8_t * s, uint16_t i);
  34:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** int16_t dns_makequery(uint16_t op, char * name, uint8_t * buf, uint16_t len);
  35:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** uint8_t DNS_query(uint8_t * dns_server, uint8_t * name, uint8_t * ip_from_dns);
  36:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
  37:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** int8_t check_DNS_timeout(void);
  38:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
  39:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
  40:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** /*
  41:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** ********************************************************************************
  42:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** *              PUT NETWORK BYTE ORDERED INT.
  43:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** *
  44:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * Description : This function copies uint16_t to the network buffer with network byte order.
  45:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * Arguments   : s - is a pointer to the network buffer.
  46:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** *               i - is a unsigned integer.
  47:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * Returns     : a pointer to the buffer.
  48:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * Note        : Internal Function
  49:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** ********************************************************************************
  50:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** */
  51:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** uint8_t * put16(uint8_t * s, uint16_t i)
  52:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** {
  31              		.loc 1 52 0
  32              		.cfi_startproc
  33              		@ args = 0, pretend = 0, frame = 8
  34              		@ frame_needed = 1, uses_anonymous_args = 0
  35              		@ link register save eliminated.
  36 0000 80B4     		push	{r7}
  37              		.cfi_def_cfa_offset 4
  38              		.cfi_offset 7, -4
  39 0002 83B0     		sub	sp, sp, #12
  40              		.cfi_def_cfa_offset 16
  41 0004 00AF     		add	r7, sp, #0
  42              		.cfi_def_cfa_register 7
  43 0006 7860     		str	r0, [r7, #4]
  44 0008 0B46     		mov	r3, r1
  45 000a 7B80     		strh	r3, [r7, #2]	@ movhi
  53:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	*s++ = i >> 8;
  46              		.loc 1 53 0
  47 000c 7B68     		ldr	r3, [r7, #4]
  48 000e 5A1C     		adds	r2, r3, #1
  49 0010 7A60     		str	r2, [r7, #4]
  50 0012 7A88     		ldrh	r2, [r7, #2]
  51 0014 120A     		lsrs	r2, r2, #8
  52 0016 92B2     		uxth	r2, r2
  53 0018 D2B2     		uxtb	r2, r2
  54 001a 1A70     		strb	r2, [r3]
  54:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	*s++ = i;
  55              		.loc 1 54 0
  56 001c 7B68     		ldr	r3, [r7, #4]
  57 001e 5A1C     		adds	r2, r3, #1
  58 0020 7A60     		str	r2, [r7, #4]
  59 0022 7A88     		ldrh	r2, [r7, #2]	@ movhi
  60 0024 D2B2     		uxtb	r2, r2
  61 0026 1A70     		strb	r2, [r3]
  55:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
  56:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	return s;
  62              		.loc 1 56 0
  63 0028 7B68     		ldr	r3, [r7, #4]
  57:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** }
  64              		.loc 1 57 0
  65 002a 1846     		mov	r0, r3
  66 002c 0C37     		adds	r7, r7, #12
  67              		.cfi_def_cfa_offset 4
  68 002e BD46     		mov	sp, r7
  69              		.cfi_def_cfa_register 13
  70              		@ sp needed
  71 0030 5DF8047B 		ldr	r7, [sp], #4
  72              		.cfi_restore 7
  73              		.cfi_def_cfa_offset 0
  74 0034 7047     		bx	lr
  75              		.cfi_endproc
  76              	.LFE0:
  78 0036 00BF     		.section	.text.dns_makequery,"ax",%progbits
  79              		.align	2
  80              		.global	dns_makequery
  81              		.thumb
  82              		.thumb_func
  84              	dns_makequery:
  85              	.LFB1:
  58:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
  59:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
  60:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** /*
  61:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** ********************************************************************************
  62:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** *              MAKE DNS QUERY MESSAGE
  63:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** *
  64:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * Description : This function makes DNS query message.
  65:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * Arguments   : op   - Recursion desired
  66:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** *               name - is a pointer to the domain name.
  67:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** *               buf  - is a pointer to the buffer for DNS message.
  68:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** *               len  - is the MAX. size of buffer.
  69:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * Returns     : the pointer to the DNS message.
  70:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * Note        :
  71:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** ********************************************************************************
  72:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** */
  73:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** int16_t dns_makequery(uint16_t op, char * name, uint8_t * buf, uint16_t len)
  74:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** {
  86              		.loc 1 74 0
  87              		.cfi_startproc
  88              		@ args = 0, pretend = 0, frame = 288
  89              		@ frame_needed = 1, uses_anonymous_args = 0
  90 0000 90B5     		push	{r4, r7, lr}
  91              		.cfi_def_cfa_offset 12
  92              		.cfi_offset 4, -12
  93              		.cfi_offset 7, -8
  94              		.cfi_offset 14, -4
  95 0002 C9B0     		sub	sp, sp, #292
  96              		.cfi_def_cfa_offset 304
  97 0004 00AF     		add	r7, sp, #0
  98              		.cfi_def_cfa_register 7
  99 0006 0446     		mov	r4, r0
 100 0008 07F10800 		add	r0, r7, #8
 101 000c 0160     		str	r1, [r0]
 102 000e 391D     		adds	r1, r7, #4
 103 0010 0A60     		str	r2, [r1]
 104 0012 1946     		mov	r1, r3
 105 0014 07F10E03 		add	r3, r7, #14
 106 0018 2246     		mov	r2, r4	@ movhi
 107 001a 1A80     		strh	r2, [r3]	@ movhi
 108 001c 07F10C03 		add	r3, r7, #12
 109 0020 0A46     		mov	r2, r1	@ movhi
 110 0022 1A80     		strh	r2, [r3]	@ movhi
  75:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	uint8_t *cp;
  76:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	char *cp1;
  77:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	char sname[MAX_DNS_BUF_SIZE];
  78:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	char *dname;
  79:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	uint16_t p;
  80:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	uint16_t dlen;
  81:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
  82:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	cp = buf;
 111              		.loc 1 82 0
 112 0024 3B1D     		adds	r3, r7, #4
 113 0026 1B68     		ldr	r3, [r3]
 114 0028 C7F81C31 		str	r3, [r7, #284]
  83:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
  84:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	MSG_ID++;
 115              		.loc 1 84 0
 116 002c 624B     		ldr	r3, .L11
 117 002e 1B88     		ldrh	r3, [r3]
 118 0030 0133     		adds	r3, r3, #1
 119 0032 9AB2     		uxth	r2, r3
 120 0034 604B     		ldr	r3, .L11
 121 0036 1A80     		strh	r2, [r3]	@ movhi
  85:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	cp = put16(cp, MSG_ID);
 122              		.loc 1 85 0
 123 0038 5F4B     		ldr	r3, .L11
 124 003a 1B88     		ldrh	r3, [r3]
 125 003c D7F81C01 		ldr	r0, [r7, #284]
 126 0040 1946     		mov	r1, r3
 127 0042 FFF7FEFF 		bl	put16
 128 0046 C7F81C01 		str	r0, [r7, #284]
  86:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	p = (op << 11) | 0x0100;			/* Recursion desired */
 129              		.loc 1 86 0
 130 004a 07F10E03 		add	r3, r7, #14
 131 004e 1B88     		ldrh	r3, [r3]
 132 0050 DB02     		lsls	r3, r3, #11
 133 0052 9BB2     		uxth	r3, r3
 134 0054 43F48073 		orr	r3, r3, #256
 135 0058 9BB2     		uxth	r3, r3
 136 005a A7F81431 		strh	r3, [r7, #276]	@ movhi
  87:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	cp = put16(cp, p);
 137              		.loc 1 87 0
 138 005e B7F81431 		ldrh	r3, [r7, #276]
 139 0062 D7F81C01 		ldr	r0, [r7, #284]
 140 0066 1946     		mov	r1, r3
 141 0068 FFF7FEFF 		bl	put16
 142 006c C7F81C01 		str	r0, [r7, #284]
  88:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	cp = put16(cp, 1);
 143              		.loc 1 88 0
 144 0070 D7F81C01 		ldr	r0, [r7, #284]
 145 0074 0121     		movs	r1, #1
 146 0076 FFF7FEFF 		bl	put16
 147 007a C7F81C01 		str	r0, [r7, #284]
  89:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	cp = put16(cp, 0);
 148              		.loc 1 89 0
 149 007e D7F81C01 		ldr	r0, [r7, #284]
 150 0082 0021     		movs	r1, #0
 151 0084 FFF7FEFF 		bl	put16
 152 0088 C7F81C01 		str	r0, [r7, #284]
  90:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	cp = put16(cp, 0);
 153              		.loc 1 90 0
 154 008c D7F81C01 		ldr	r0, [r7, #284]
 155 0090 0021     		movs	r1, #0
 156 0092 FFF7FEFF 		bl	put16
 157 0096 C7F81C01 		str	r0, [r7, #284]
  91:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	cp = put16(cp, 0);
 158              		.loc 1 91 0
 159 009a D7F81C01 		ldr	r0, [r7, #284]
 160 009e 0021     		movs	r1, #0
 161 00a0 FFF7FEFF 		bl	put16
 162 00a4 C7F81C01 		str	r0, [r7, #284]
  92:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
  93:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	strcpy(sname, name);
 163              		.loc 1 93 0
 164 00a8 07F11002 		add	r2, r7, #16
 165 00ac 07F10803 		add	r3, r7, #8
 166 00b0 1046     		mov	r0, r2
 167 00b2 1968     		ldr	r1, [r3]
 168 00b4 FFF7FEFF 		bl	strcpy
  94:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	dname = sname;
 169              		.loc 1 94 0
 170 00b8 07F11003 		add	r3, r7, #16
 171 00bc C7F81831 		str	r3, [r7, #280]
  95:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	dlen = strlen(dname);
 172              		.loc 1 95 0
 173 00c0 D7F81801 		ldr	r0, [r7, #280]
 174 00c4 FFF7FEFF 		bl	strlen
 175 00c8 0346     		mov	r3, r0
 176 00ca A7F81631 		strh	r3, [r7, #278]	@ movhi
 177              	.L9:
  96:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	for (;;)
  97:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	{
  98:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		/* Look for next dot */
  99:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		cp1 = strchr(dname, '.');
 178              		.loc 1 99 0
 179 00ce D7F81801 		ldr	r0, [r7, #280]
 180 00d2 2E21     		movs	r1, #46
 181 00d4 FFF7FEFF 		bl	strchr
 182 00d8 C7F81001 		str	r0, [r7, #272]
 100:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 101:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		if (cp1 != NULL) len = cp1 - dname;	/* More to come */
 183              		.loc 1 101 0
 184 00dc D7F81031 		ldr	r3, [r7, #272]
 185 00e0 002B     		cmp	r3, #0
 186 00e2 08D0     		beq	.L4
 187              		.loc 1 101 0 is_stmt 0 discriminator 1
 188 00e4 D7F81021 		ldr	r2, [r7, #272]
 189 00e8 D7F81831 		ldr	r3, [r7, #280]
 190 00ec D21A     		subs	r2, r2, r3
 191 00ee 07F10C03 		add	r3, r7, #12
 192 00f2 1A80     		strh	r2, [r3]	@ movhi
 193 00f4 04E0     		b	.L5
 194              	.L4:
 102:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		else len = dlen;			/* Last component */
 195              		.loc 1 102 0 is_stmt 1
 196 00f6 07F10C03 		add	r3, r7, #12
 197 00fa B7F81621 		ldrh	r2, [r7, #278]	@ movhi
 198 00fe 1A80     		strh	r2, [r3]	@ movhi
 199              	.L5:
 103:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 104:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		*cp++ = len;				/* Write length of component */
 200              		.loc 1 104 0
 201 0100 D7F81C31 		ldr	r3, [r7, #284]
 202 0104 5A1C     		adds	r2, r3, #1
 203 0106 C7F81C21 		str	r2, [r7, #284]
 204 010a 07F10C02 		add	r2, r7, #12
 205 010e 1288     		ldrh	r2, [r2]	@ movhi
 206 0110 D2B2     		uxtb	r2, r2
 207 0112 1A70     		strb	r2, [r3]
 105:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		if (len == 0) break;
 208              		.loc 1 105 0
 209 0114 07F10C03 		add	r3, r7, #12
 210 0118 1B88     		ldrh	r3, [r3]
 211 011a 002B     		cmp	r3, #0
 212 011c 00D1     		bne	.L6
 213 011e 31E0     		b	.L7
 214              	.L6:
 106:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 107:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		/* Copy component up to (but not including) dot */
 108:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		strncpy((char *)cp, dname, len);
 215              		.loc 1 108 0
 216 0120 07F10C03 		add	r3, r7, #12
 217 0124 1B88     		ldrh	r3, [r3]
 218 0126 D7F81C01 		ldr	r0, [r7, #284]
 219 012a D7F81811 		ldr	r1, [r7, #280]
 220 012e 1A46     		mov	r2, r3
 221 0130 FFF7FEFF 		bl	strncpy
 109:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		cp += len;
 222              		.loc 1 109 0
 223 0134 07F10C03 		add	r3, r7, #12
 224 0138 1B88     		ldrh	r3, [r3]
 225 013a D7F81C21 		ldr	r2, [r7, #284]
 226 013e 1344     		add	r3, r3, r2
 227 0140 C7F81C31 		str	r3, [r7, #284]
 110:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		if (cp1 == NULL)
 228              		.loc 1 110 0
 229 0144 D7F81031 		ldr	r3, [r7, #272]
 230 0148 002B     		cmp	r3, #0
 231 014a 07D1     		bne	.L8
 111:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		{
 112:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 			*cp++ = 0;			/* Last one; write null and finish */
 232              		.loc 1 112 0
 233 014c D7F81C31 		ldr	r3, [r7, #284]
 234 0150 5A1C     		adds	r2, r3, #1
 235 0152 C7F81C21 		str	r2, [r7, #284]
 236 0156 0022     		movs	r2, #0
 237 0158 1A70     		strb	r2, [r3]
 113:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 			break;
 238              		.loc 1 113 0
 239 015a 13E0     		b	.L7
 240              	.L8:
 114:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		}
 115:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		dname += len+1;
 241              		.loc 1 115 0
 242 015c 07F10C03 		add	r3, r7, #12
 243 0160 1B88     		ldrh	r3, [r3]
 244 0162 0133     		adds	r3, r3, #1
 245 0164 D7F81821 		ldr	r2, [r7, #280]
 246 0168 1344     		add	r3, r3, r2
 247 016a C7F81831 		str	r3, [r7, #280]
 116:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		dlen -= len+1;
 248              		.loc 1 116 0
 249 016e 07F10C03 		add	r3, r7, #12
 250 0172 B7F81621 		ldrh	r2, [r7, #278]	@ movhi
 251 0176 1B88     		ldrh	r3, [r3]	@ movhi
 252 0178 D31A     		subs	r3, r2, r3
 253 017a 9BB2     		uxth	r3, r3
 254 017c 013B     		subs	r3, r3, #1
 255 017e A7F81631 		strh	r3, [r7, #278]	@ movhi
 117:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	}
 256              		.loc 1 117 0
 257 0182 A4E7     		b	.L9
 258              	.L7:
 118:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 119:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	cp = put16(cp, 0x0001);				/* type */
 259              		.loc 1 119 0
 260 0184 D7F81C01 		ldr	r0, [r7, #284]
 261 0188 0121     		movs	r1, #1
 262 018a FFF7FEFF 		bl	put16
 263 018e C7F81C01 		str	r0, [r7, #284]
 120:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	cp = put16(cp, 0x0001);				/* class */
 264              		.loc 1 120 0
 265 0192 D7F81C01 		ldr	r0, [r7, #284]
 266 0196 0121     		movs	r1, #1
 267 0198 FFF7FEFF 		bl	put16
 268 019c C7F81C01 		str	r0, [r7, #284]
 121:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 122:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	return ((int16_t)((uint32_t)(cp) - (uint32_t)(buf)));
 269              		.loc 1 122 0
 270 01a0 D7F81C21 		ldr	r2, [r7, #284]
 271 01a4 3B1D     		adds	r3, r7, #4
 272 01a6 1B68     		ldr	r3, [r3]
 273 01a8 D31A     		subs	r3, r2, r3
 274 01aa 9BB2     		uxth	r3, r3
 275 01ac 1BB2     		sxth	r3, r3
 123:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** }
 276              		.loc 1 123 0
 277 01ae 1846     		mov	r0, r3
 278 01b0 07F59277 		add	r7, r7, #292
 279              		.cfi_def_cfa_offset 12
 280 01b4 BD46     		mov	sp, r7
 281              		.cfi_def_cfa_register 13
 282              		@ sp needed
 283 01b6 90BD     		pop	{r4, r7, pc}
 284              	.L12:
 285              		.align	2
 286              	.L11:
 287 01b8 00000000 		.word	MSG_ID
 288              		.cfi_endproc
 289              	.LFE1:
 291              		.section	.text.DNS_query,"ax",%progbits
 292              		.align	2
 293              		.global	DNS_query
 294              		.thumb
 295              		.thumb_func
 297              	DNS_query:
 298              	.LFB2:
 124:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 125:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** /*
 126:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** ********************************************************************************
 127:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** *              MAKE DNS QUERY AND PARSE THE REPLY
 128:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** *
 129:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * Description : This function makes DNS query message and parses the reply from DNS server.
 130:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * Arguments   : name - is a pointer to the domain name.
 131:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * Returns     : if succeeds : 1, fails : 0
 132:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * Note        :
 133:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** ********************************************************************************
 134:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** */
 135:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** uint8_t DNS_query(uint8_t * dns_server, uint8_t * name, uint8_t * ip_from_dns)
 136:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** {
 299              		.loc 1 136 0
 300              		.cfi_startproc
 301              		@ args = 0, pretend = 0, frame = 48
 302              		@ frame_needed = 1, uses_anonymous_args = 0
 303 0000 90B5     		push	{r4, r7, lr}
 304              		.cfi_def_cfa_offset 12
 305              		.cfi_offset 4, -12
 306              		.cfi_offset 7, -8
 307              		.cfi_offset 14, -4
 308 0002 8FB0     		sub	sp, sp, #60
 309              		.cfi_def_cfa_offset 72
 310 0004 02AF     		add	r7, sp, #8
 311              		.cfi_def_cfa 7, 64
 312 0006 F860     		str	r0, [r7, #12]
 313 0008 B960     		str	r1, [r7, #8]
 314 000a 7A60     		str	r2, [r7, #4]
 137:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	struct dhdr dhp;
 138:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	uint8_t ip[4];
 139:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	uint16_t len, port;
 140:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	int8_t ret_check_timeout;
 141:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	uint16_t dns_port;
 142:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 143:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	len = dns_makequery(0, (char *)name, dns_buf, MAX_DNS_BUF_SIZE);
 315              		.loc 1 143 0
 316 000c 3C4B     		ldr	r3, .L22
 317 000e 1B68     		ldr	r3, [r3]
 318 0010 0020     		movs	r0, #0
 319 0012 B968     		ldr	r1, [r7, #8]
 320 0014 1A46     		mov	r2, r3
 321 0016 4FF48073 		mov	r3, #256
 322 001a FFF7FEFF 		bl	dns_makequery
 323 001e 0346     		mov	r3, r0
 324 0020 FB85     		strh	r3, [r7, #46]	@ movhi
 144:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	sendto(DNS_SOCKET, dns_buf, len, dns_server, IPPORT_DOMAIN);
 325              		.loc 1 144 0
 326 0022 384B     		ldr	r3, .L22+4
 327 0024 1878     		ldrb	r0, [r3]	@ zero_extendqisi2
 328 0026 364B     		ldr	r3, .L22
 329 0028 1968     		ldr	r1, [r3]
 330 002a FA8D     		ldrh	r2, [r7, #46]
 331 002c 3523     		movs	r3, #53
 332 002e 0093     		str	r3, [sp]
 333 0030 FB68     		ldr	r3, [r7, #12]
 334 0032 FFF7FEFF 		bl	sendto
 335              	.L20:
 145:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 146:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 147:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	while (1)
 148:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	{
 149:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		if ((len = getSn_RX_RSR(DNS_SOCKET)) > 0)
 336              		.loc 1 149 0
 337 0036 334B     		ldr	r3, .L22+4
 338 0038 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 339 003a 1846     		mov	r0, r3
 340 003c FFF7FEFF 		bl	getSn_RX_RSR
 341 0040 0346     		mov	r3, r0
 342 0042 FB85     		strh	r3, [r7, #46]	@ movhi
 343 0044 FB8D     		ldrh	r3, [r7, #46]
 344 0046 002B     		cmp	r3, #0
 345 0048 21D0     		beq	.L14
 150:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		{
 151:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 			if (len > MAX_DNS_BUF_SIZE) len = MAX_DNS_BUF_SIZE;
 346              		.loc 1 151 0
 347 004a FB8D     		ldrh	r3, [r7, #46]
 348 004c B3F5807F 		cmp	r3, #256
 349 0050 02D9     		bls	.L15
 350              		.loc 1 151 0 is_stmt 0 discriminator 1
 351 0052 4FF48073 		mov	r3, #256
 352 0056 FB85     		strh	r3, [r7, #46]	@ movhi
 353              	.L15:
 152:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 			len = recvfrom(DNS_SOCKET, dns_buf, len, ip, &port);
 354              		.loc 1 152 0 is_stmt 1
 355 0058 2A4B     		ldr	r3, .L22+4
 356 005a 1878     		ldrb	r0, [r3]	@ zero_extendqisi2
 357 005c 284B     		ldr	r3, .L22
 358 005e 1968     		ldr	r1, [r3]
 359 0060 FA8D     		ldrh	r2, [r7, #46]
 360 0062 07F11404 		add	r4, r7, #20
 361 0066 07F11203 		add	r3, r7, #18
 362 006a 0093     		str	r3, [sp]
 363 006c 2346     		mov	r3, r4
 364 006e FFF7FEFF 		bl	recvfrom
 365 0072 0346     		mov	r3, r0
 366 0074 FB85     		strh	r3, [r7, #46]	@ movhi
 153:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 			break;
 367              		.loc 1 153 0
 368 0076 00BF     		nop
 154:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		}
 155:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 156:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		// Check Timeout
 157:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		ret_check_timeout = check_DNS_timeout();
 158:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 159:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		if (ret_check_timeout < 0) {
 160:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 161:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** #ifdef _DNS_DEBUG_
 162:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 			printf("> DNS Server is not responding : %d.%d.%d.%d\r\n", dns_server[0], dns_server[1], dns_ser
 163:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** #endif
 164:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 			return 0; // timeout occurred
 165:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		}
 166:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		else if (ret_check_timeout == 0) {
 167:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 168:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** #ifdef _DNS_DEBUG_
 169:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 			printf("> Timeout\r\n");
 170:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** #endif
 171:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 			// Generate random port number
 172:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 			//srand(seed); users can use the seed value for make random variable.
 173:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 			dns_port = rand() % 2000 + 63535; // 63535 ~ 65534
 174:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 175:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 			// Socket open
 176:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 			socket(DNS_SOCKET, Sn_MR_UDP, dns_port, 0);
 177:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 178:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 			sendto(DNS_SOCKET, dns_buf, len, dns_server, IPPORT_DOMAIN);
 179:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		}
 180:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	}
 181:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 182:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	return(parseMSG(&dhp, dns_buf, ip_from_dns));	/* Convert to local format */
 369              		.loc 1 182 0
 370 0078 214B     		ldr	r3, .L22
 371 007a 1B68     		ldr	r3, [r3]
 372 007c 07F11802 		add	r2, r7, #24
 373 0080 1046     		mov	r0, r2
 374 0082 1946     		mov	r1, r3
 375 0084 7A68     		ldr	r2, [r7, #4]
 376 0086 FFF7FEFF 		bl	parseMSG
 377 008a 0346     		mov	r3, r0
 378 008c 34E0     		b	.L21
 379              	.L14:
 157:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 380              		.loc 1 157 0
 381 008e FFF7FEFF 		bl	check_DNS_timeout
 382 0092 0346     		mov	r3, r0
 383 0094 87F82D30 		strb	r3, [r7, #45]
 159:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 384              		.loc 1 159 0
 385 0098 97F92D30 		ldrsb	r3, [r7, #45]
 386 009c 002B     		cmp	r3, #0
 387 009e 01DA     		bge	.L17
 164:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		}
 388              		.loc 1 164 0
 389 00a0 0023     		movs	r3, #0
 390 00a2 29E0     		b	.L21
 391              	.L17:
 166:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 392              		.loc 1 166 0
 393 00a4 97F92D30 		ldrsb	r3, [r7, #45]
 394 00a8 002B     		cmp	r3, #0
 395 00aa 24D1     		bne	.L19
 173:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 396              		.loc 1 173 0
 397 00ac FFF7FEFF 		bl	rand
 398 00b0 0246     		mov	r2, r0
 399 00b2 154B     		ldr	r3, .L22+8
 400 00b4 83FB0213 		smull	r1, r3, r3, r2
 401 00b8 D911     		asrs	r1, r3, #7
 402 00ba D317     		asrs	r3, r2, #31
 403 00bc CB1A     		subs	r3, r1, r3
 404 00be 4FF4FA61 		mov	r1, #2000
 405 00c2 01FB03F3 		mul	r3, r1, r3
 406 00c6 D31A     		subs	r3, r2, r3
 407 00c8 9BB2     		uxth	r3, r3
 408 00ca A3F2D173 		subw	r3, r3, #2001
 409 00ce 7B85     		strh	r3, [r7, #42]	@ movhi
 176:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 410              		.loc 1 176 0
 411 00d0 0C4B     		ldr	r3, .L22+4
 412 00d2 1A78     		ldrb	r2, [r3]	@ zero_extendqisi2
 413 00d4 7B8D     		ldrh	r3, [r7, #42]
 414 00d6 1046     		mov	r0, r2
 415 00d8 0221     		movs	r1, #2
 416 00da 1A46     		mov	r2, r3
 417 00dc 0023     		movs	r3, #0
 418 00de FFF7FEFF 		bl	socket
 178:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		}
 419              		.loc 1 178 0
 420 00e2 084B     		ldr	r3, .L22+4
 421 00e4 1878     		ldrb	r0, [r3]	@ zero_extendqisi2
 422 00e6 064B     		ldr	r3, .L22
 423 00e8 1968     		ldr	r1, [r3]
 424 00ea FA8D     		ldrh	r2, [r7, #46]
 425 00ec 3523     		movs	r3, #53
 426 00ee 0093     		str	r3, [sp]
 427 00f0 FB68     		ldr	r3, [r7, #12]
 428 00f2 FFF7FEFF 		bl	sendto
 429              	.L19:
 180:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 430              		.loc 1 180 0
 431 00f6 9EE7     		b	.L20
 432              	.L21:
 183:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** }
 433              		.loc 1 183 0 discriminator 1
 434 00f8 1846     		mov	r0, r3
 435 00fa 3437     		adds	r7, r7, #52
 436              		.cfi_def_cfa_offset 12
 437 00fc BD46     		mov	sp, r7
 438              		.cfi_def_cfa_register 13
 439              		@ sp needed
 440 00fe 90BD     		pop	{r4, r7, pc}
 441              	.L23:
 442              		.align	2
 443              	.L22:
 444 0100 00000000 		.word	dns_buf
 445 0104 00000000 		.word	DNS_SOCKET
 446 0108 D34D6210 		.word	274877907
 447              		.cfi_endproc
 448              	.LFE2:
 450              		.section	.text.DNS_init,"ax",%progbits
 451              		.align	2
 452              		.global	DNS_init
 453              		.thumb
 454              		.thumb_func
 456              	DNS_init:
 457              	.LFB3:
 184:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 185:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** /*
 186:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** ********************************************************************************
 187:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** *              DNS CLIENT INIT
 188:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** *
 189:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * Description : This function initialize DNS client
 190:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * Arguments   : s - is a DNS socket number, buf - is a pointer of user's buffer
 191:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * Returns     : None.
 192:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * Note        :
 193:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** ********************************************************************************
 194:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** */
 195:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 196:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** void DNS_init(uint8_t s, uint8_t * buf)
 197:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** {
 458              		.loc 1 197 0
 459              		.cfi_startproc
 460              		@ args = 0, pretend = 0, frame = 16
 461              		@ frame_needed = 1, uses_anonymous_args = 0
 462 0000 80B5     		push	{r7, lr}
 463              		.cfi_def_cfa_offset 8
 464              		.cfi_offset 7, -8
 465              		.cfi_offset 14, -4
 466 0002 84B0     		sub	sp, sp, #16
 467              		.cfi_def_cfa_offset 24
 468 0004 00AF     		add	r7, sp, #0
 469              		.cfi_def_cfa_register 7
 470 0006 0346     		mov	r3, r0
 471 0008 3960     		str	r1, [r7]
 472 000a FB71     		strb	r3, [r7, #7]
 198:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	uint16_t dns_port = 3000;
 473              		.loc 1 198 0
 474 000c 40F6B833 		movw	r3, #3000
 475 0010 FB81     		strh	r3, [r7, #14]	@ movhi
 199:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 200:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	DNS_SOCKET = s; // SOCK_DNS
 476              		.loc 1 200 0
 477 0012 144A     		ldr	r2, .L25
 478 0014 FB79     		ldrb	r3, [r7, #7]
 479 0016 1370     		strb	r3, [r2]
 201:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	dns_buf = buf; // User's shared buffer
 480              		.loc 1 201 0
 481 0018 134A     		ldr	r2, .L25+4
 482 001a 3B68     		ldr	r3, [r7]
 483 001c 1360     		str	r3, [r2]
 202:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	MSG_ID = 0x1122;
 484              		.loc 1 202 0
 485 001e 134B     		ldr	r3, .L25+8
 486 0020 41F22212 		movw	r2, #4386
 487 0024 1A80     		strh	r2, [r3]	@ movhi
 203:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 204:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	// Generate random port number
 205:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	//srand(seed); users can use the seed value for make random variable.
 206:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	dns_port = rand() % 2000 + 63535; // 63535 ~ 65534
 488              		.loc 1 206 0
 489 0026 FFF7FEFF 		bl	rand
 490 002a 0246     		mov	r2, r0
 491 002c 104B     		ldr	r3, .L25+12
 492 002e 83FB0213 		smull	r1, r3, r3, r2
 493 0032 D911     		asrs	r1, r3, #7
 494 0034 D317     		asrs	r3, r2, #31
 495 0036 CB1A     		subs	r3, r1, r3
 496 0038 4FF4FA61 		mov	r1, #2000
 497 003c 01FB03F3 		mul	r3, r1, r3
 498 0040 D31A     		subs	r3, r2, r3
 499 0042 9BB2     		uxth	r3, r3
 500 0044 A3F2D173 		subw	r3, r3, #2001
 501 0048 FB81     		strh	r3, [r7, #14]	@ movhi
 207:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	// Socket open
 208:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	socket(DNS_SOCKET, Sn_MR_UDP, dns_port, 0);
 502              		.loc 1 208 0
 503 004a 064B     		ldr	r3, .L25
 504 004c 1A78     		ldrb	r2, [r3]	@ zero_extendqisi2
 505 004e FB89     		ldrh	r3, [r7, #14]
 506 0050 1046     		mov	r0, r2
 507 0052 0221     		movs	r1, #2
 508 0054 1A46     		mov	r2, r3
 509 0056 0023     		movs	r3, #0
 510 0058 FFF7FEFF 		bl	socket
 209:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** }
 511              		.loc 1 209 0
 512 005c 1037     		adds	r7, r7, #16
 513              		.cfi_def_cfa_offset 8
 514 005e BD46     		mov	sp, r7
 515              		.cfi_def_cfa_register 13
 516              		@ sp needed
 517 0060 80BD     		pop	{r7, pc}
 518              	.L26:
 519 0062 00BF     		.align	2
 520              	.L25:
 521 0064 00000000 		.word	DNS_SOCKET
 522 0068 00000000 		.word	dns_buf
 523 006c 00000000 		.word	MSG_ID
 524 0070 D34D6210 		.word	274877907
 525              		.cfi_endproc
 526              	.LFE3:
 528              		.section	.text.DNS_run,"ax",%progbits
 529              		.align	2
 530              		.global	DNS_run
 531              		.thumb
 532              		.thumb_func
 534              	DNS_run:
 535              	.LFB4:
 210:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 211:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** /*
 212:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** ********************************************************************************
 213:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** *              DNS CLIENT RUN
 214:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** *
 215:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * Description : This function get the IP address from DNS
 216:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * Arguments   : dns_server_1st - IP address of primary DNS server
 217:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * 				dns_server_2nd - IP address of secondary DNS server
 218:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * 				name - is a pointer to the domain name.
 219:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * 				ip_from_dns - IP address of domain from DNS server
 220:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * Returns     : 0 - both failed / 1 - primary success / 2 - secondary success (primary failed)
 221:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * Note        :
 222:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** ********************************************************************************
 223:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** */
 224:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 225:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** uint8_t DNS_run(uint8_t * dns_server_1st, uint8_t * dns_server_2nd, uint8_t * name, uint8_t * ip_fr
 226:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** {
 536              		.loc 1 226 0
 537              		.cfi_startproc
 538              		@ args = 0, pretend = 0, frame = 24
 539              		@ frame_needed = 1, uses_anonymous_args = 0
 540 0000 80B5     		push	{r7, lr}
 541              		.cfi_def_cfa_offset 8
 542              		.cfi_offset 7, -8
 543              		.cfi_offset 14, -4
 544 0002 86B0     		sub	sp, sp, #24
 545              		.cfi_def_cfa_offset 32
 546 0004 00AF     		add	r7, sp, #0
 547              		.cfi_def_cfa_register 7
 548 0006 F860     		str	r0, [r7, #12]
 549 0008 B960     		str	r1, [r7, #8]
 550 000a 7A60     		str	r2, [r7, #4]
 551 000c 3B60     		str	r3, [r7]
 227:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	uint8_t ret;
 228:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 229:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** #ifdef _DNS_DEBUG_
 230:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	printf("> DNS Query to Primary DNS Server : %d.%d.%d.%d\r\n", dns_server_1st[0], dns_server_1st[1]
 231:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** #endif
 232:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 233:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	ret = DNS_query(dns_server_1st, name, ip_from_dns);
 552              		.loc 1 233 0
 553 000e F868     		ldr	r0, [r7, #12]
 554 0010 7968     		ldr	r1, [r7, #4]
 555 0012 3A68     		ldr	r2, [r7]
 556 0014 FFF7FEFF 		bl	DNS_query
 557 0018 0346     		mov	r3, r0
 558 001a FB75     		strb	r3, [r7, #23]
 234:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 235:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	if(!ret) {
 559              		.loc 1 235 0
 560 001c FB7D     		ldrb	r3, [r7, #23]	@ zero_extendqisi2
 561 001e 002B     		cmp	r3, #0
 562 0020 0FD1     		bne	.L28
 236:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		if(dns_server_2nd != 0) {
 563              		.loc 1 236 0
 564 0022 BB68     		ldr	r3, [r7, #8]
 565 0024 002B     		cmp	r3, #0
 566 0026 0CD0     		beq	.L28
 237:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 238:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** #ifdef _DNS_DEBUG_
 239:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 			printf("> DNS Query to Secondary DNS Server : %d.%d.%d.%d\r\n", dns_server_2nd[0], dns_server_2n
 240:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** #endif
 241:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 			ret = DNS_query(dns_server_2nd, name, ip_from_dns);
 567              		.loc 1 241 0
 568 0028 B868     		ldr	r0, [r7, #8]
 569 002a 7968     		ldr	r1, [r7, #4]
 570 002c 3A68     		ldr	r2, [r7]
 571 002e FFF7FEFF 		bl	DNS_query
 572 0032 0346     		mov	r3, r0
 573 0034 FB75     		strb	r3, [r7, #23]
 242:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 			if(ret == 1) ret++;
 574              		.loc 1 242 0
 575 0036 FB7D     		ldrb	r3, [r7, #23]	@ zero_extendqisi2
 576 0038 012B     		cmp	r3, #1
 577 003a 02D1     		bne	.L28
 578              		.loc 1 242 0 is_stmt 0 discriminator 1
 579 003c FB7D     		ldrb	r3, [r7, #23]	@ zero_extendqisi2
 580 003e 0133     		adds	r3, r3, #1
 581 0040 FB75     		strb	r3, [r7, #23]
 582              	.L28:
 243:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		}
 244:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	}
 245:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 246:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	close(DNS_SOCKET);
 583              		.loc 1 246 0 is_stmt 1
 584 0042 054B     		ldr	r3, .L30
 585 0044 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 586 0046 1846     		mov	r0, r3
 587 0048 FFF7FEFF 		bl	close
 247:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	// Return value
 248:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	// 0 - both failed / 1 - primary success / 2 - secondary success (primary failed)
 249:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	return ret;
 588              		.loc 1 249 0
 589 004c FB7D     		ldrb	r3, [r7, #23]	@ zero_extendqisi2
 250:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** }
 590              		.loc 1 250 0
 591 004e 1846     		mov	r0, r3
 592 0050 1837     		adds	r7, r7, #24
 593              		.cfi_def_cfa_offset 8
 594 0052 BD46     		mov	sp, r7
 595              		.cfi_def_cfa_register 13
 596              		@ sp needed
 597 0054 80BD     		pop	{r7, pc}
 598              	.L31:
 599 0056 00BF     		.align	2
 600              	.L30:
 601 0058 00000000 		.word	DNS_SOCKET
 602              		.cfi_endproc
 603              	.LFE4:
 605              		.section	.text.check_DNS_timeout,"ax",%progbits
 606              		.align	2
 607              		.global	check_DNS_timeout
 608              		.thumb
 609              		.thumb_func
 611              	check_DNS_timeout:
 612              	.LFB5:
 251:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 252:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** /*
 253:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** ********************************************************************************
 254:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** *              CHECK DNS TIMEOUT
 255:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** *
 256:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * Description : This function check the DNS timeout
 257:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * Arguments   : None.
 258:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * Returns     : -1 - timeout occurred, 0 - timer over, but no timeout, 1 - no timer over, no timeou
 259:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * Note        : timeout : retry count and timer both over.
 260:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** ********************************************************************************
 261:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** */
 262:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 263:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** int8_t check_DNS_timeout(void)
 264:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** {
 613              		.loc 1 264 0
 614              		.cfi_startproc
 615              		@ args = 0, pretend = 0, frame = 0
 616              		@ frame_needed = 1, uses_anonymous_args = 0
 617              		@ link register save eliminated.
 618 0000 80B4     		push	{r7}
 619              		.cfi_def_cfa_offset 4
 620              		.cfi_offset 7, -4
 621 0002 00AF     		add	r7, sp, #0
 622              		.cfi_def_cfa_register 7
 265:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	static uint8_t retry_count;
 266:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 267:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	if(dns_time >= DNS_WAIT_TIME)
 623              		.loc 1 267 0
 624 0004 0F4B     		ldr	r3, .L36
 625 0006 1B68     		ldr	r3, [r3]
 626 0008 022B     		cmp	r3, #2
 627 000a 13D9     		bls	.L33
 268:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	{
 269:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		dns_time = 0;
 628              		.loc 1 269 0
 629 000c 0D4B     		ldr	r3, .L36
 630 000e 0022     		movs	r2, #0
 631 0010 1A60     		str	r2, [r3]
 270:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		if(retry_count >= MAX_DNS_RETRY) {
 632              		.loc 1 270 0
 633 0012 0D4B     		ldr	r3, .L36+4
 634 0014 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 635 0016 012B     		cmp	r3, #1
 636 0018 04D9     		bls	.L34
 271:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 			retry_count = 0;
 637              		.loc 1 271 0
 638 001a 0B4B     		ldr	r3, .L36+4
 639 001c 0022     		movs	r2, #0
 640 001e 1A70     		strb	r2, [r3]
 272:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 			return -1; // timeout occurred
 641              		.loc 1 272 0
 642 0020 FF23     		movs	r3, #255
 643 0022 08E0     		b	.L35
 644              	.L34:
 273:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		}
 274:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		retry_count++;
 645              		.loc 1 274 0
 646 0024 084B     		ldr	r3, .L36+4
 647 0026 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 648 0028 0133     		adds	r3, r3, #1
 649 002a DAB2     		uxtb	r2, r3
 650 002c 064B     		ldr	r3, .L36+4
 651 002e 1A70     		strb	r2, [r3]
 275:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 		return 0; // timer over, but no timeout
 652              		.loc 1 275 0
 653 0030 0023     		movs	r3, #0
 654 0032 00E0     		b	.L35
 655              	.L33:
 276:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	}
 277:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 278:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	return 1; // no timer over, no timeout occur
 656              		.loc 1 278 0
 657 0034 0123     		movs	r3, #1
 658              	.L35:
 659 0036 5BB2     		sxtb	r3, r3
 279:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** }
 660              		.loc 1 279 0
 661 0038 1846     		mov	r0, r3
 662 003a BD46     		mov	sp, r7
 663              		.cfi_def_cfa_register 13
 664              		@ sp needed
 665 003c 5DF8047B 		ldr	r7, [sp], #4
 666              		.cfi_restore 7
 667              		.cfi_def_cfa_offset 0
 668 0040 7047     		bx	lr
 669              	.L37:
 670 0042 00BF     		.align	2
 671              	.L36:
 672 0044 00000000 		.word	dns_time
 673 0048 00000000 		.word	retry_count.6000
 674              		.cfi_endproc
 675              	.LFE5:
 677              		.section	.text.DNS_timerHandler,"ax",%progbits
 678              		.align	2
 679              		.global	DNS_timerHandler
 680              		.thumb
 681              		.thumb_func
 683              	DNS_timerHandler:
 684              	.LFB6:
 280:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 
 281:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** /*
 282:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** ***************************************************************************************************
 283:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** *				DNS TIMER HANDLER
 284:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** *
 285:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * Description: This function must be called once per second in the timer interrupt handler.
 286:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * Arguments  : None.
 287:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * Returns    : None.
 288:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** * Note       :
 289:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** ***************************************************************************************************
 290:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** */
 291:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** void DNS_timerHandler(void)
 292:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** {
 685              		.loc 1 292 0
 686              		.cfi_startproc
 687              		@ args = 0, pretend = 0, frame = 0
 688              		@ frame_needed = 1, uses_anonymous_args = 0
 689              		@ link register save eliminated.
 690 0000 80B4     		push	{r7}
 691              		.cfi_def_cfa_offset 4
 692              		.cfi_offset 7, -4
 693 0002 00AF     		add	r7, sp, #0
 694              		.cfi_def_cfa_register 7
 293:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** 	dns_time++;
 695              		.loc 1 293 0
 696 0004 044B     		ldr	r3, .L39
 697 0006 1B68     		ldr	r3, [r3]
 698 0008 0133     		adds	r3, r3, #1
 699 000a 034A     		ldr	r2, .L39
 700 000c 1360     		str	r3, [r2]
 294:/home/virusv/TDSAST_IOT/Internet/DNS/dns.c **** }
 701              		.loc 1 294 0
 702 000e BD46     		mov	sp, r7
 703              		.cfi_def_cfa_register 13
 704              		@ sp needed
 705 0010 5DF8047B 		ldr	r7, [sp], #4
 706              		.cfi_restore 7
 707              		.cfi_def_cfa_offset 0
 708 0014 7047     		bx	lr
 709              	.L40:
 710 0016 00BF     		.align	2
 711              	.L39:
 712 0018 00000000 		.word	dns_time
 713              		.cfi_endproc
 714              	.LFE6:
 716              		.section	.bss.retry_count.6000,"aw",%nobits
 719              	retry_count.6000:
 720 0000 00       		.space	1
 721              		.text
 722              	.Letext0:
 723              		.file 2 "/usr/include/newlib/machine/_default_types.h"
 724              		.file 3 "/usr/include/newlib/sys/_stdint.h"
 725              		.file 4 "/home/virusv/TDSAST_IOT/Internet/DNS/dns.h"
DEFINED SYMBOLS
                            *ABS*:0000000000000000 dns.c
                            *COM*:0000000000000004 dns_buf
                            *COM*:0000000000000001 DNS_SOCKET
                            *COM*:0000000000000002 MSG_ID
                            *COM*:0000000000000004 dns_time
     /tmp/cch8BrJq.s:23     .text.put16:0000000000000000 $t
     /tmp/cch8BrJq.s:28     .text.put16:0000000000000000 put16
     /tmp/cch8BrJq.s:79     .text.dns_makequery:0000000000000000 $t
     /tmp/cch8BrJq.s:84     .text.dns_makequery:0000000000000000 dns_makequery
     /tmp/cch8BrJq.s:287    .text.dns_makequery:00000000000001b8 $d
     /tmp/cch8BrJq.s:292    .text.DNS_query:0000000000000000 $t
     /tmp/cch8BrJq.s:297    .text.DNS_query:0000000000000000 DNS_query
     /tmp/cch8BrJq.s:611    .text.check_DNS_timeout:0000000000000000 check_DNS_timeout
     /tmp/cch8BrJq.s:444    .text.DNS_query:0000000000000100 $d
     /tmp/cch8BrJq.s:451    .text.DNS_init:0000000000000000 $t
     /tmp/cch8BrJq.s:456    .text.DNS_init:0000000000000000 DNS_init
     /tmp/cch8BrJq.s:521    .text.DNS_init:0000000000000064 $d
     /tmp/cch8BrJq.s:529    .text.DNS_run:0000000000000000 $t
     /tmp/cch8BrJq.s:534    .text.DNS_run:0000000000000000 DNS_run
     /tmp/cch8BrJq.s:601    .text.DNS_run:0000000000000058 $d
     /tmp/cch8BrJq.s:606    .text.check_DNS_timeout:0000000000000000 $t
     /tmp/cch8BrJq.s:672    .text.check_DNS_timeout:0000000000000044 $d
     /tmp/cch8BrJq.s:719    .bss.retry_count.6000:0000000000000000 retry_count.6000
     /tmp/cch8BrJq.s:678    .text.DNS_timerHandler:0000000000000000 $t
     /tmp/cch8BrJq.s:683    .text.DNS_timerHandler:0000000000000000 DNS_timerHandler
     /tmp/cch8BrJq.s:712    .text.DNS_timerHandler:0000000000000018 $d
     /tmp/cch8BrJq.s:720    .bss.retry_count.6000:0000000000000000 $d
                     .debug_frame:0000000000000010 $d

UNDEFINED SYMBOLS
strcpy
strlen
strchr
strncpy
sendto
getSn_RX_RSR
recvfrom
parseMSG
rand
socket
close
